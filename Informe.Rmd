---
title: "Estudio sobre estudiantes en situación de desplazamiento en Santander"
author: 
  - Erick Mateo Hernandez Rangel 
  - Nicolás Cárdenas Rodríguez
  - Laura Andrea Rodríguez Mejía
date: "`r Sys.Date()`"
output: 
  html_document: 
    theme: yeti
    toc: TRUE
    toc_float: TRUE
    number_sections: TRUE
    code_folding: show
lang: es-ES
header-includes:
  - \usepackage{graphicx}
  - |
    \usepackage{fancyhdr}
    \pagestyle{fancy}
    \fancyhf{}
    \renewcommand{\headrulewidth}{0pt}
---

::: {style="text-align: center; margin-bottom: 20px;"}
<img src="imagenes/portada_desplazamiento.png" style="max-width: 100%; height: auto;"/>
:::

------------------------------------------------------------------------

# Introducción

El desplazamiento forzado es uno de los problemas más graves y persistentes que enfrenta Colombia. La violencia generada por los conflictos armados, el accionar de grupos ilegales y el deterioro de la seguridad en diversas regiones del país han ocasionado un desplazamiento masivo de millones de colombianos. Y este problema no ha hecho mas que empeorar, de hecho según La Defensoría del Pueblo se reportó un incremento significativo, reflejando un alarmante deterioro en la seguridad, con más de 13.500 personas desplazadas solo en los primeros cinco meses de este año (2024) [1]. 

Aunque Santander no es uno de los departamentos con la mayor cantidad de casos de desplazamiento en Colombia, el problema sigue siendo una realidad en esta región. Entre las personas desplazadas, hay estudiantes que se ven directamente afectados por esta situación. Con este estudio, buscamos comprender mejor como son estos estudiantes. De aquí surge nuestra pregunta de investigación: **¿Cuáles son las características de los estudiantes en situación de desplazamiento en los municipios no certificados de Santander?**

Para abordar este problema, utilizaremos un dataset proporcionado por la Secretaría de Educación de Santander, que contiene información sobre los estudiantes desplazados matriculados en instituciones educativas de los 82 municipios no certificados del departamento. Este será nuestra herramienta principal para realizar un análisis detallado de la población estudiantil desplazada en la región. A medida que avancemos en el análisis, responderemos preguntas adicionales, tales como: ¿cómo se distribuyen estas poblaciones por género, edad y etnia?, ¿qué tipos de desplazamiento son los más comunes? y ¿cómo se distribuyen los estudiantes según los municipios?


# Metodología
El dataset utilizado para la realización de este estudio contiene información acerca de estudiantes en sitación de desplazamiento matriculados en instituciones educativas de los 82 municipios no certificados del departamento de Santander. Los datos fueron recopilados y actualizados por la **Secretaría de Educación de Santander**. 

**Origen y última actualización**

- **Creación: ** 30 de septiembre del 2022.

- **Última actualización: ** 29 de julio del 2024. 

- **Fuente oficial:** [Datos Abiertos Colombia - Estudiantes en situación de desplazamiento en Santander](https://www.datos.gov.co/Educaci-n/ESTUDIANTES-EN-SITUACI-N-DE-DESPLAZAMIENTO-EN-SANT/wemp-b8gd/about_data)

**Estructura del dataset**

El dataset tiene **22 variables** (columnas) y **18.062 registros**, con información que abarca desde datos sobre las instituciones educativas hasta características específicas de los estudiantes. Algunas de sus variables mas importantes son: 

- **d_ano**:  año en que se recopilo la informació0.n 

- **d_muni** y **d_nombmuni**: código y nombre de los municipios.

- **d_provincia**:  provincia a la que pertenece el municipio. 

- **d_nomsec**: naturaleza de la institución (privada u oficial).

- **dane_ant** y **d_sede**:  codido DANE anterior de la institución (si aplica) y código DANE actual. 

- **d_nombinst**: nombre del instituto donde esta matriculado el estudiante. 

- **d_grado**: grado académico del estudiante. 

- **d_genero** y **edad**:  edad del estudiante. 

- **d_genero**, **d_hombres**, **d_mujeres**: información relacionada con el género. 

- **d_tipo**: clasificación según el tipo de desplazamiento. 

- **etnia**: indica a que grupo étnico pertence el estudiante. 

- **discapa**: indica si el estudiante tiene una discapacidad. 

- **metodo**: método educativo del estudiante.  

## Paquetes
Para la realización de este proyecto, se utilizaron los siguientes paquetes: 

-  `library(skimr)`: este paquete se empleó para obtener un resumen detallado del conjunto de datos. Gracias a él, pudimos explorar las principales características del dataset de manera eficiente.

- `ggplot2`: este paquete fue utilizado para crear gráficos de alta calidad. Nos permitió generar diversos diagramas que muestran distribuciones y relaciones entre los datos

-  `dplyr`: este paquete fue usado para la manipulación de datos. Con él, pudimos filtrar, seleccionar, transformar y resumir la información, facilitando la preparación de los datos necesarios para las visualizaciones.

-  `RColorBrewer`: este paquete ofrece paletas de colores predefinidas, con el pudimos mejorar la estética de nuestros gráficos y hacerlos visualmente mas atractivos. 

-  `sf`: para trabajar con datos geoespaciales, como coordenadas y límites geográficos, utilizada para realizar el mapa de calor. 

-  `tidyr`: este paquete se utilizo para transformar y manipular datos de manera mas sencilla, facilitando así tareas como agrupar, resumir y organizar información relevante para realizar las gráficas. 

## Preparación de los datos

```{r echo=FALSE, warning=FALSE, message=FALSE}

if (!require(dplyr)) install.packages("dplyr")
if (!require(ggplot2)) install.packages("ggplot2")
if (!require(sf)) install.packages("sf")
if (!require(skimr)) install.packages("skimr")
if (!require(RColorBrewer)) install.packages("RColorBrewer")
if (!require(kableExtra)) install.packages("kableExtra")
if (!require(DT)) install.packages("DT")
if (!require(tidyr)) install.packages("tidyr")

```

```{r echo=FALSE, warning=FALSE, message=FALSE}

library(dplyr)
library(ggplot2)
library(sf)
library(skimr)
library(RColorBrewer)
library(kableExtra)
library(DT)
library(tidyr)

```

**Cargado del dataset**

Para empezar, cargamos el dataset utilizando la función `read.csv()`, de esta forma pudimos importar los datos desde el archivo (CSV) para trabajar con ellos. 

**Exploración del dataset**

Antes de empezar con la limpieza de los datos, hicimos una exploración inicial del dataset para entender su contenido y estructura: 

1. Usamos `dim()` para verificar el número de filas y columnas y `str()` para explorar que tipo de datos tiene cada columna. 

2. Con `summary()` y `skim()` generamos resúmenes estadísticos para entender mejor los valores de las variables. 

3. Con `head()` y `tail()` inspeccionamos los registros iniciales y finales del dataset. 

4. También utilizamos `sum(is.na(dataset))` para identificar si habian valores faltantes y cuantos eran. 

5. Con `unique()` y `summary()` exploramos más a detalle columnas de interés para nuestro estudio. 

En base a esta exploración inicial podemos decir lo siguiente sobre el dataset: 

- Tiene 18.062 filas (registros) y 22 columnas (variables)

- De las 22 variables, 18 son cualitativas nominales, 3 cuantitativas discretas y 1 cualitativa ordinal.

- El dataset no tiene valores nulos. 

- Hay columnas duplicadas: edad y d_edad contienen los mismos datos. 

**Limpieza de los datos**

Tras la exploración, se realizo lo siguiente: 

1. Se elimino la columna edad porque contenia información duplicada. 

2. Además se eliminaron las columnas d_nomjor y sector, ya que no eran relevantes para el estudio que queriamos hacer. 

3. La columna dane_ant fue convertida de tipo entero a carácter. 

4. Las variables categóricas discapa y d_tipo fueron convertidas a factores para facilitar el análisis. 

5. En la columna discapa, se agruparon y renombraron categorías relacionadas para reducir redundancias y unificar términos. 

Posterior a la limpieza de los datos, el dataset se mantuvo con la misma cantidad de registros (18.062) y con 19 columnas. Y quedó de la siguiente manera: 

```{r echo=FALSE, warning=FALSE, message=FALSE}

dataset <- read.csv("Estudiantes_en_situacion_de_desplazamiento_Santander.csv")

dataset <- dataset %>%
  select(-edad, -d_nomjor, -sector)

dataset$dane_ant <- as.character(dataset$dane_ant)

dataset$discapa <- factor(dataset$discapa)
dataset$d_tipo <- factor(dataset$d_tipo)

dataset <- dataset %>%
  mutate(discapa = recode(discapa, 
                          "DISCAPACIDAD VISUAL BAJA VISIÓN IRREVERS" = "DISCAPACIDAD VISUAL", 
                          "DISCAPACIDAD VISUAL SEGUERA" = "DISCAPACIDAD VISUAL", 
                          "DISCAPACIDAD VISUAL BAJA VISIÓN IRREVERSIBLE" = "DISCAPACIDAD VISUAL",
                          "DISCAPACIDAD VISUAL CEGUERA" = "DISCAPACIDAD VISUAL",    
                          "DISCAPACIDAD AUDITIVA - USUARIO DE LENGU" = "DISCAPACIDAD AUDITIVA", 
                          "AUDITIVA  USUARIO DEL CASTELLANO" = "DISCAPACIDAD AUDITIVA", 
                          "DISCAPACIDAD AUDITIVA USUARIO DEL CASTELLANO" = "DISCAPACIDAD AUDITIVA",
                          "DISCAPACIDAD AUDITIVA - USUARIO DE LENGUA DE SEÑAS COLOMBIANA" = "DISCAPACIDAD AUDITIVA",
                          "DISCAPACIDAD FÍSICA" = "DISCAPACIDAD FISICA"))

datatable(dataset, options = list(pageLength = 10, scrollX = TRUE))

```

## Análisis exploratorio de los datos

El análisis exploratorio de los datos se estructuró en cuatro partes principales, esto con el objetivo de responder a la pregunta de investigación que nos planteamos al iniciar este estudio. Estas partes son:

**Análisis demográfico**

En este análisis se exploraron diversas características relacionadas con los estudiantes, como su género, edad, pertenencia étnica, etc. A continuación se explica cómo se realizó cada diagrama:

- **Distribución por género**: en este diagrama queríamos mostrar la distribución de los estudiantes por su género (femenino y masculino). Para ello se calcularon las frecuencias absolutas y relativas, se renombraron las categorías a "FEMENINO" y "MASCULINO" para mejorar la interpretación y, por último, se creó un diagrama de torta que ilustra la distribución porcentual.

- **Distribución por edad**: la variable edad se analizó dividiéndola por rangos. A partir de estos rangos se creó un diagrama de barras que muestra la frecuencia de estudiantes en cada rango. Además, se crearon dos diagramas más, un gráfico de barras que muestra la distribución de los estudiantes por rangos de edad y género, y un gráfico de cajas que permite visualizar la dispersión y los valores típicos de la edad según el género.

- **Distribución étnica**: para hacer este análisis, primero se creó una nueva columna en el dataset que clasifica si los estudiantes pertenecen o no a un grupo étnico. A partir de esta columna se generó un diagrama de torta que muestra estas proporciones. Luego, se filtraron los datos de los estudiantes que sí pertenecen a un grupo étnico y se creó un diagrama de barras con la frecuencia de cada grupo étnico.

- **Distribución por discapacidad**: para esta variable se creó también una nueva columna para clasificar si el estudiante tiene o no una discapacidad y, a partir de ahí, se creó un gráfico de torta para mostrar estas proporciones. Luego, se filtraron los datos para solo incluir a los estudiantes con discapacidad y se creó un gráfico de barras que muestra las frecuencias para cada tipo de discapacidad.

- **Distribución por tipo de desplazamiento**: para mostrar esta variable se generó un gráfico de barras que muestra la distribución de los estudiantes según el tipo de desplazamiento reportado en el dataset.

**Análisis geográfico**

Este análisis estuvo centrado en ver cómo los estudiantes se distribuyen de acuerdo a su municipio y tipo de zona.

- **Distribucion de la población por municipio**: esta distribución se creó procesando datos de la población y combinándolos con un archivo geográfico (shapefile) que contiene los límites municipales del departamente de Santander. Se calcularon los totales de población por municipio y se unieron con las regiones geográficas mediante un campo común. La visualización se generó con ggplot2, utilizando colores para representar la cantidad de población desplazada. 

**Análisis de las instituciones**

El análisis de las instituciones estuvo orientado a explorar aspectos como el número de estudiantes por institución y la clasificación de estas según diferentes criterios.

- **Distribución por sector**: para crear este diagrama, se contó el número de instituciones según su sector, calculando los porcentajes. Luego, con ggplot2, se generó el gráfico de torta. 

- **Distribución por zona**: para realizar este diagrama se obtuvieron los datos sobre las instituciones, enfocándose en si eran rurales o urbanas. Luego se organizó la información seleccionando los datos relevantes y se contó cuántas instituciones pertenecían a cada categoría.A partir de esto, se creó un gráfico de torta. 

- **Distribución por método educativo**: para este diagrama, se contabilizó la cantidad de registros por cada método educativo en el conjunto de datos y se calculó el porcentaje de participación de cada uno. Con ggplot2, se generó un gráfico de barras apiladas, donde el eje x representa los métodos, y el eje y, los porcentajes. 

- **Instituciones con mayor cantidad de estudiantes**: este gráfico se creó seleccionando las 10 instituciones con mayor cantidad de estudiantes desplazados, utilizando un resumen agrupado por institución para calcular el total de estudiantes en cada una. Luego, se ordenaron los resultados de mayor a menor y se construyó un gráfico de barras con ggplot2, en el que las instituciones están en el eje x y el número de estudiantes en el eje y. 

**Análisis relacional**


En este análisis quisimos identificar patrones y conexiones significativas entre diferentes variables.

- **Relación entre el método educativo entre caracteristicas demográficas**:

  - **Relación con género**: se procesaron los datos para calcular el total de hombres y mujeres por método educativo y se reorganizaron en un formato más visual mediante pivot_longer. Luego, con ggplot2, se creó un gráfico de dispersión donde el eje x representa los métodos, el eje y la cantidad de estudiantes, y los puntos se colorearon por género.
  
  - **Relación con el grupo étnico**: los datos fueron procesados para calcular la población total de hombres y mujeres por cada método educativo y grupo étnico. Luego, se utilizó ggplot2 para crear un gráfico de dispersión, donde el eje x representa los métodos educativos, el eje y la población total, y los puntos se colorearon según el grupo étnico. 
  
  - **Relación con la edad**: se generó a partir de los datos de edad por método educativo. Primero, se seleccionaron las columnas correspondientes y se calculó el promedio de edad por método educativo, usando la función group_by para agrupar los datos y summarise para obtener el promedio. Luego, se creó un gráfico de puntos con ggplot, donde se representan los métodos educativos en el eje X y el promedio de edad en el eje Y.
  

- **Relación entre los motivos de desplazamiento con el grupo étnico de las personas**: este gráfico muestra la relación entre el motivo de desplazamiento y el grupo étnico. Primero, se seleccionaron las columnas relevantes del conjunto de datos, se limpiaron y transformaron los valores para que estuvieran en formato adecuado. Luego, se agruparon los datos por motivo y grupo étnico, y se calculó la población total de hombres y mujeres en cada grupo. Finalmente, se creó un gráfico de dispersión en el que el tamaño de los puntos representa la población total y el color corresponde al grupo étnico.

# Resultados


## Análisis demográfico

Enfocado en analizar las características de la población estudiantil desplazada. 

**¿Cómo se distribuye la población por género?**

```{r, echo=FALSE, warning=FALSE, message=FALSE}
datos_genero <- dataset %>%
  count(d_genero) %>%
  mutate(
    porcentaje = round(n / sum(n) * 100, 1),  
    renombre_genero = recode(d_genero, "F" = "FEMENINO", "M" = "MASCULINO"),  
    etiqueta = paste0(n, " (", porcentaje, "%)") 
  )

ggplot(datos_genero, aes(x = "", y = n, fill = renombre_genero)) +
  geom_bar(stat = "identity", width = 1, color = "white") +  
  coord_polar("y") +                       
  geom_text(aes(label = etiqueta),          
            position = position_stack(vjust = 0.5), size = 4) + 
  labs(title = "Distribución por género", fill = "Género") +
  theme_void() +                           
  theme(
    legend.position = "right",
    plot.title = element_text(hjust = 0.5)) 
```

La distribución por género muestra que el 48.7% de los estudiantes son mujeres (8.801), mientras que el 51.3% son hombres (9.261). Esto indica que, aunque la mayoría de los estudiantes son hombres, la diferencia en términos de género es relativamente pequeña.

**¿Cuál es la distribución de la población por edades?**

```{r, echo=FALSE, warning=FALSE, message=FALSE}
n_datos <- nrow(dataset)  
rango <- max(dataset$d_edad) - min(dataset$d_edad)
intervalos <- ceiling(1 + log2(n_datos))  
amplitud <- floor(rango / intervalos)

min_edad <- floor(min(dataset$d_edad))  
max_edad <- ceiling(max(dataset$d_edad) + 2)  

rangos_edad <- cut(dataset$d_edad, 
                   breaks = seq(min_edad, max_edad, by = amplitud),  
                   include.lowest = TRUE, 
                   right = FALSE)  

dataset$rango_edad <- rangos_edad

ggplot(dataset, aes(x = rango_edad)) +
  geom_bar(fill = "skyblue", color = "white") +  
  geom_text(stat = "count", aes(label = after_stat(count)), vjust = -0.5, size = 3) +  
  labs(title = "Distribución por edad", 
       x = "Rangos de edad", y = "Frecuencia") +  
  theme(plot.title = element_text(hjust = 0.5),
        panel.background = element_blank())
```

El rango de 11 a 15 años es el que agrupa la mayor parte de la población, con 7.068 registros. Le sigue el rango de 15 a 19 años con 5.118 registros, y luego el de 7 a 11 años, con 4.842 registros.

```{r, echo=FALSE, warning=FALSE, message=FALSE}
datos_barras <- dataset %>%
  group_by(rango_edad, d_genero) %>%
  summarise(conteo = n(), .groups = "drop")  

ggplot(datos_barras, aes(x = rango_edad, y = conteo, fill = d_genero)) +
  geom_bar(stat = "identity", position = position_dodge(width = 0.9), color = "white") +  
  geom_text(aes(label = conteo), 
            position = position_dodge(width = 0.9), 
            vjust = -0.5, size = 2.5) +  
  labs(title = "Distribución por edad y género", 
       x = "Rango de edad", y = "Frecuencia", fill = "Género") +  
  theme(plot.title = element_text(hjust = 0.5),
        panel.background = element_blank(), 
        axis.text.x = element_text(size = 7)) 
```

También se analizó la distribución de las edades por género. En el rango de 11 a 15 años, se registraron 3.457 mujeres y 3.611 hombres. En el rango de 15 a 19 años, la distribución es de 2.496 mujeres y 2.622 hombres, mientras que en el rango de 7 a 11 años, hay 2.345 mujeres y 2.497 hombres.

En los únicos rangos donde se registran más mujeres que hombres son 23 a 27 años, con 37 mujeres y 27 hombres; 35 a 39 años, con 12 mujeres y 8 hombres; y en el rango de 59 a 63, con 4 mujeres frente a 1 hombre.

```{r, echo=FALSE, warning=FALSE, message=FALSE}
ggplot(dataset, aes(x = d_genero, y = d_edad, fill = d_genero)) +
  geom_boxplot(outlier.colour = "red", outlier.shape = 16, outlier.size = 2) +  
  labs(title = "Distribución de edad por género",
       x = "Género", y = "Edad") +  
  theme(plot.title = element_text(hjust = 0.5),
        panel.background = element_rect(fill = "white"),  
        panel.grid.major = element_line(color = "gray", size = 0.5),  
        panel.grid.minor = element_line(color = "gray", size = 0.25),  
        legend.position = "none") + 
  scale_y_continuous(breaks = seq(0, 70, by = 5)) 
```

En este gráfico podemos observar que la mediana de la edad en ambos géneros se encuentra aproximadamente en los 13 años, lo que indica que el 50 % de los estudiantes tienen 13 años o menos. El tercer cuartil, que representa aproximadamente al 75 % de los estudiantes, alcanza hasta los 15 años, lo que significa que el 75 % de los registros tienen 15 años o menos.

En cuanto a los bigotes del diagrama, podemos notar que en las mujeres los bigotes inferiores se extienden un poco más abajo que en los hombres. Esto significa que la edad mínima en las mujeres es de aproximadamente 3 años, mientras que en los hombres es de alrededor de 4 años. En ambos géneros, los bigotes superiores se extienden hasta aproximadamente los 23 años. A partir de esa edad comienzan a aparecer los outliers.

La presencia de tantos outliers indica que hay una pequeña cantidad de estudiantes fuera del rango típico de edad, pero estos valores atípicos son muy variados en cuanto a la edad. En el caso de las mujeres, los outliers se extienden hasta los 62 o 63 años, mientras que en los hombres llegan aproximadamente hasta los 69 años.

**¿Cómo se distribuye la población según la etnia? **

```{r, echo=FALSE, warning=FALSE, message=FALSE}
dataset$pertenece_etnia <- ifelse(dataset$etnia == "NINGUN GRUPO ETNICO", "NO PERTENECE", "PERTENECE")

ggplot(dataset, aes(x = "", fill = pertenece_etnia)) +
  geom_bar(stat = "count", width = 1, color = "white") +  
  coord_polar("y") +  
  geom_text(stat = "count", aes(label = paste0(..count.., " (", round(..count../sum(..count..)*100, 1), "%)")), 
            position = position_stack(vjust = 0.5), size = 4) +  
  labs(title = "Distribución étnica (pertenece o no a una etnia)", fill = "Etnia") +  
  theme_void() + 
  theme(plot.title = element_text(hjust = 0.5))  
```

La distribución de la población según la etnia muestra que el 98.2 % de los estudiantes no pertenece a ningún grupo étnico, mientras que solo el 1.8 % (322 personas) sí pertenece a alguno.

```{r, echo=FALSE, warning=FALSE, message=FALSE}
dataset_etnia <- dataset[dataset$pertenece_etnia == "PERTENECE", ]

ggplot(dataset_etnia, aes(y = etnia)) +
  geom_bar(fill = "purple", color = "white") +  
  geom_text(stat = "count", aes(label = ..count..), hjust = -0.2, size = 3) +  
  labs(title = "Distribución por grupo étnico", 
       x = "Frecuencia", y = "Grupo étnico") +  
  theme(plot.title = element_text(hjust = 0.5),
        panel.background = element_blank(),
        axis.text.y = element_text(angle = 0, hjust = 1))
```

De estas 322 personas, la mayoría pertenece al grupo étnico de las negritudes, seguido de 72 personas que se identifican como afrodescendientes.

**¿Qué proporción de la población tiene alguna discapacidad?**

```{r, echo=FALSE, warning=FALSE, message=FALSE}
dataset$tiene_discapacidad <- ifelse(dataset$discapa == "NO TIENE DISCAPACIDAD", "NO TIENE", "TIENE")

ggplot(dataset, aes(x = "", fill = tiene_discapacidad)) +
  geom_bar(stat = "count", width = 1, color = "white") +  
  coord_polar("y") +  
  geom_text(stat = "count", aes(label = paste0(..count.., " (", round(..count../sum(..count..)*100, 1), "%)")), 
            position = position_stack(vjust = 0.5), size = 4) +  
  labs(title = "Distribución por discapacidad (tiene o no una discapacidad)", fill = "Discapacidad") +  
  theme_void() + 
  theme(plot.title = element_text(hjust = 0.5)) 
```

El 97.6% de la población no tiene ninguna discapacidad, lo que representa una gran mayoría en comparación con el 2.4% (442 personas) que sí presentan alguna discapacidad.

```{r, echo=FALSE, warning=FALSE, message=FALSE}
dataset_discapacidad <- dataset[dataset$tiene_discapacidad == "TIENE", ]

ggplot(dataset_discapacidad, aes(x = discapa, fill = discapa)) +
  geom_bar(color = "white") +  
  geom_text(stat = "count", aes(label = ..count..), vjust = -0.5, size = 3) +  
  scale_fill_brewer(palette = "Set1") +  
  labs(title = "Distribución por discapacidad", 
       x = "Discapacidad", y = "Frecuencia") +  
  theme(plot.title = element_text(hjust = 0.5),  
        panel.background = element_blank(),  
        axis.text.x = element_blank(),  
        legend.position = "right",  
        legend.title = element_blank())  
```

En el gráfico siguiente, podemos observar que la mayoría de las 442 personas tienen discapacidad mental, con un total de 190 casos. Les siguen las personas con discapacidad psicosocial, que suman 91 en total.

**¿Cuáles son los tipos de desplazamiento más comunes?**

```{r, echo=FALSE, warning=FALSE, message=FALSE, fig.width=10, fig.height=8}
ggplot(dataset, aes(y = d_tipo)) +
  geom_bar(fill = "red", color = "white") +  
  geom_text(stat = "count", aes(label = ..count..), hjust = -0.2, size = 3) +  
  labs(title = "Distribución por tipo de desplazamiento", 
       x = "Frecuencia", y = "Tipo de desplazamiento") +  
  theme(plot.title = element_text(hjust = 0.5),  
        panel.background = element_blank(),  
        axis.text.x = element_text(angle = 0, hjust = 1),  
        legend.position = "none")  
```

En el diagrama, podemos observar que los tres tipos de desplazamiento con más registros son los siguientes: el más frecuente es "VÍCTIMA", con un total de 12.532 registros, lo que representa la mayoría de los casos. En segundo lugar, se encuentra la categoría "EN SITUACIÓN DE DESPLAZAMIENTO", con 3.951 registros, y el tercer tipo más común es "DESPLAZAMIENTO FORZADO", con 1.034 registros.

## Análisis geográfico

Enfocado en analizar cómo se distribuye la población. 

**¿Cómo está distribuida la población entre los diferentes municipios?**

```{r echo=FALSE, warning=FALSE, message=FALSE, fig.width=10, fig.height=8}

data <- as.data.frame(dataset)

data <- data %>% 
  select(d_nombmuni, d_nomzon, d_hombres, d_mujeres) %>% 
  rename(municipio = d_nombmuni, principio = d_nomzon, hombres = d_hombres, mujeres = d_mujeres) %>% 
  mutate(hombres = as.numeric(hombres),
         mujeres = as.numeric(mujeres),
         poblacion = hombres + mujeres,
         municipio = toupper(trimws(municipio))) %>% 
  group_by(municipio, principio) %>% 
  summarise(total_poblacion = sum(poblacion, na.rm = TRUE))

shape_data <- st_read("MGN_ADM_MPIO_GRAFICO.shp", quiet = TRUE)

shape_data <- shape_data %>% 
  filter(dpto_cnmbr == "SANTANDER") %>%  
  mutate(mpio_cnmbr = toupper(trimws(mpio_cnmbr)))  

shape_data <- shape_data %>% 
  left_join(data, by = c("mpio_cnmbr" = "municipio"))


if (!"total_poblacion" %in% names(shape_data)) {
  stop("No se pudo unir correctamente los datos de población con los datos espaciales. Revisa los nombres de las columnas.")
}

ggplot(shape_data) +
  geom_sf(aes(fill = total_poblacion), color = NA) +
  scale_fill_viridis_c(option = "plasma", na.value = "grey") +  
  geom_sf_text(
    data = shape_data %>% filter(!is.na(total_poblacion)),  
    aes(label = mpio_cnmbr),
    size = 3, color = "black", check_overlap = TRUE  
  ) +
  labs(title = "Distribución de la población desplazada por municipios en Santander",
       fill = "Población") +
  theme_minimal() + 
  theme(plot.title = element_text(hjust = 0.5))

```

CORREGIR 


## Análisis de las instituciones 
Enfocado en analizar las instituciones educativas y su relación con la población desplazada. 

**¿A qué sector pertenecen las instituciones en donde estudian las personas desplazadas?**

```{r, echo=FALSE, warning=FALSE, message=FALSE}

datos_nomsec <- dataset %>%
  count(d_nomsec) %>%
  mutate(
    porcentaje = round(n / sum(n) * 100, 1),  
    renombre_nomsec = recode(d_nomsec, "O" = "Oficial", "P" = "Privado"),  
    etiqueta = paste0(n, " (", porcentaje, "%)") 
  )

ggplot(datos_nomsec, aes(x = "", y = n, fill = renombre_nomsec)) +
  geom_bar(stat = "identity", width = 1) +  
  coord_polar("y") +                       
  geom_text(aes(label = etiqueta),          
            position = position_stack(vjust = 0.5), size = 4) + 
  labs(title = "Distribución por sector de la institucion", fill = "Sector") +
  theme_void() +                           
  theme(
    legend.position = "right",
    plot.title = element_text(hjust = 0.5)) 

```

Se observa que, en la distribución de los porcentajes de las instituciones por sector, el 92.2% pertenecen al sector oficial, mientras que el 7.8% al sector privado. Esto muestra que la gran mayoria de instituciones hacen parte del sector oficial. 

**¿A qué zona pertenecen las instituciones en donde estudian las personas desplazadas?**

```{r, echo=FALSE, warning=FALSE, message=FALSE}
zona_data <- dataset %>%
  select(d_nomzon) %>%  
  rename(zona = d_nomzon) %>%  
  mutate(zona = toupper(trimws(zona))) %>%  
  group_by(zona) %>%  
  summarise(cantidad = n()) %>%  
  mutate(porcentaje = round(cantidad / sum(cantidad) * 100, 2),  
         etiqueta = paste0(cantidad, " (", porcentaje, "%)"))  

ggplot(zona_data, aes(x = "", y = cantidad, fill = zona)) +
  geom_bar(stat = "identity", width = 1) +
  coord_polar("y", start = 0) +
  geom_text(aes(label = etiqueta), position = position_stack(vjust = 0.5), size = 4) +  
  scale_fill_brewer(palette = "Set3") +
  labs(title = "Distribución de instituciones por zona (rural/urbana)",
       fill = "Zona") +
  theme_void() +
  theme(axis.text.x = element_blank(),  
        axis.ticks = element_blank())  

```

En esta distribución podemos observar que la mayoria de las instituciones se encuentra en zona urbana con un 56.9 % frente a un 43.1 % en las zonas rurales. 

**¿Qué método educativo es más común entre los estudiantes desplazados?**

```{r, echo=FALSE, warning=FALSE, message=FALSE}

datos_metodo <- dataset %>%
  count(metodo) %>%
  mutate(
    porcentaje = round(n / sum(n) * 100, 2),
    etiqueta = paste0(n, " (", porcentaje, "%)")  
  )

ggplot(datos_metodo, aes(x = metodo, y = porcentaje, fill = metodo)) +
  geom_bar(stat = "identity", fill = "orange", width = 0.7) +  
  geom_text(aes(label = etiqueta), vjust = 0.5, color = "black", size = 3, hjust = 0.3) + 
  labs(title = "Distribución por método", 
       x = "Método",
       y = "Porcentaje de distribución") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1), 
        panel.grid = element_blank(),
        plot.title = element_text(hjust = 0.5)) 
```

El método educativo más común entre los estudiantes desplazados es la educación tradicional, con un 69.1% de los estudiantes utilizando este enfoque. Este porcentaje es significativamente mayor en comparación con el segundo método más común, que representa solo el 14.32%. Esto muestra que la educación tradicional es la opción mas utilizada por los estudiantes desplazados. 

**¿Cuáles son los institutos con mayor número de estudiantes desplazados?**

```{r, echo=FALSE, warning=FALSE, message=FALSE}

conteo_inst <- dataset %>%
  group_by(d_nombinst) %>%
  summarise(total_estudiantes = n()) %>%  
  arrange(desc(total_estudiantes))  

est_x_inst <- head(conteo_inst, 10)

ggplot(est_x_inst, aes(x = reorder(d_nombinst, total_estudiantes), y = total_estudiantes, fill = d_nombinst)) +
  geom_bar(stat = "identity", color = "white") + 
  geom_text(aes(label = total_estudiantes), vjust = -0.5, size = 2.5) +
  scale_fill_brewer(palette = "Set3") +  # Colores diferentes por categoría
  labs(title = "Instituciones con más estudiantes desplazados",
       x = "Institución", y = "Estudiantes desplazados") +
  theme(plot.title = element_text(hjust = -1),  
        panel.background = element_blank(),  
        axis.text.x = element_blank(),  
        legend.position = "right",  
        legend.title = element_blank())  
```

En la gráfica se muestran las 10 instituciones con mayor número de estudiantes desplazados. El colegio con más estudiantes es el Colegio Integrado Madre de la Esperanza, con 1211 estudiantes, casi el doble que los tres siguientes, que tienen 678, 675 y 673 estudiantes desplazados matriculados, respectivamente.

## Análisis relacional 
Enfocado en explorar correlaciones o patrones entre las variables del dataset. 

**¿Existe relación entre el método educativo y características demográficas como género, étnica y edad?**

```{r, echo=FALSE, warning=FALSE, message=FALSE}

genero_data <- dataset %>%
  select(metodo, d_hombres, d_mujeres) %>%
  rename(metodo = metodo, hombres = d_hombres, mujeres = d_mujeres) %>%
  mutate(hombres = as.numeric(hombres),
         mujeres = as.numeric(mujeres)) %>%
  group_by(metodo) %>%
  summarise(total_hombres = sum(hombres, na.rm = TRUE),
            total_mujeres = sum(mujeres, na.rm = TRUE)) %>%
  pivot_longer(cols = c(total_hombres, total_mujeres),
               names_to = "genero",
               values_to = "cantidad")

ggplot(genero_data, aes(x = metodo, y = cantidad, color = genero)) +
  geom_point(size = 5, alpha = 0.7) +
  scale_y_continuous(limits = c(0, max(genero_data$cantidad))) +
  labs(title = "Relación entre método educativo y sexo",
       x = "Método educativo",
       y = "Cantidad",
       color = "Sexo") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1),
         plot.title = element_text(hjust = 0.5))

```

En esta gráfica se puede observar que la mayoría de los estudiantes emplean el método de estudio tradicional. También se muestra que en los métodos de educación tradicional, escuela nueva y post primaria, la mayoría de los estudiantes son hombres. En los métodos de media rural y SAT, las cifras son similares para ambos géneros, con los puntos representativos superpuestos en la misma posición. Sin embargo, en el método "Programa para Jóvenes en Extraedad y Adultos", se observa una mayor cantidad de mujeres que de hombres.

```{r, echo=FALSE, warning=FALSE, message=FALSE, fig.width=10, fig.height=8}

etnico_data <- dataset %>%
  select(metodo, etnia, d_hombres, d_mujeres) %>%
  rename(metodo = metodo, grupo_etnico = etnia, hombres = d_hombres, mujeres = d_mujeres) %>%
  mutate(hombres = as.numeric(hombres),
         mujeres = as.numeric(mujeres),
         grupo_etnico = toupper(trimws(grupo_etnico))) %>%
  group_by(metodo, grupo_etnico) %>%
  summarise(total_poblacion = sum(hombres + mujeres, na.rm = TRUE))

ggplot(etnico_data, aes(x = metodo, y = total_poblacion, color = grupo_etnico)) +
  geom_point(size = 5, alpha = 0.7) +
  labs(title = "Relación entre método educativo y grupo étnico",
       x = "Método educativo",
       y = "Población total",
       color = "Grupo étnico") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1),
        plot.title = element_text(hjust = 0.5))

```

```{r, echo=FALSE, warning=FALSE, message=FALSE}

tabla_etnico <- etnico_data %>%
  pivot_wider(names_from = metodo, values_from = total_poblacion, values_fill = 0)

tabla_etnico %>%
  kbl(caption = "Distribución de población por grupo étnico y método educativo",
      col.names = c("GRUPO ÉTNICO", unique(etnico_data$metodo)),
      align = "c") %>%
  kable_styling(full_width = TRUE, bootstrap_options = c("striped", "hover", "condensed"))

```

En este gráfico podemos notar que, para todos los métodos, la mayoría de los estudiantes no pertenecen a ningún grupo étnico, lo cual tiene sentido, ya que, como vimos anteriormente, más del 90% de los registros corresponden a personas que no se identifican con ningún grupo étnico. También podemos observar que, por ejemplo, las personas del grupo étnico U'WA eligen el método de estudio "Escuela Nueva", al igual que los del grupo Zenú. En el "Programa para Jóvenes en Extraedad y Adultos", se destaca la presencia de los grupos étnicos Ebera Chami, y la etnia Negritudes aparece en la "Educación Tradicional" y la "Media Rural". Además, también se observa la presencia del grupo Piapoco en la "Educación Tradicional".

```{r, echo=FALSE, warning=FALSE, message=FALSE}

edad_data <- dataset %>%
  select(metodo, d_edad) %>%  
  rename(metodo = metodo, edad = d_edad) %>%
  mutate(edad = as.numeric(edad)) %>%
  group_by(metodo) %>%
  summarise(promedio_edad = mean(edad, na.rm = TRUE))

ggplot(edad_data, aes(x = metodo, y = promedio_edad)) +
  geom_point(color = "purple", size = 5, alpha = 0.7) +
  labs(title = "Relación entre método educativo y promedio de edad",
       x = "Método educativo",
       y = "Promedio de edad") +
  theme_minimal() + 
  theme(axis.text.x = element_text(angle = 45, hjust = 1),
        plot.title = element_text(hjust = 0.5))

```

En este gráfico, podemos observar las edades promedio de los estudiantes según el método de estudio. En "Educación Tradicional", la edad promedio es de aproximadamente 13 años, mientras que en "Escuela Nueva" es de aproximadamente 9 años. En "Media Rural", la edad promedio es de alrededor de 17 años, y en "Postprimaria", es de 15 años. En el "Programa para Jóvenes en Extraedad y Adultos", la edad promedio es de 18 años, y en el SAT es de 24 años.

**¿Cómo se relacionan los motivos de desplazamiento con el grupo étnico de los personas?**

```{r, echo=FALSE, warning=FALSE, message=FALSE, fig.width=10, fig.height=8}

data <- as.data.frame(dataset)  

displacement_data <- data %>%
  select(d_tipo, etnia, d_hombres, d_mujeres) %>%
  rename(motivo = d_tipo, grupo_etnico = etnia, hombres = d_hombres, mujeres = d_mujeres) %>%
  mutate(hombres = as.numeric(hombres),
         mujeres = as.numeric(mujeres),
         grupo_etnico = toupper(trimws(grupo_etnico)),
         motivo = toupper(trimws(motivo))) %>%
  group_by(motivo, grupo_etnico) %>%
  summarise(total_poblacion = sum(hombres + mujeres, na.rm = TRUE))

ggplot(displacement_data, aes(x = motivo, y = grupo_etnico, size = total_poblacion, color = grupo_etnico)) +
  geom_point(alpha = 0.7) +
  labs(title = "Relación entre motivo de desplazamiento y grupo étnico",
       x = "Motivo de desplazamiento",
       y = "Grupo étnico",
       size = "Población total",
       color = "Grupo étnico") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1), 
        plot.title = element_text(hjust = 0.5))

```

En esta gráfica, se observa que la mayoría de los registros corresponden a personas que no pertenecen a ningún grupo étnico, lo que tiene sentido, ya que más del 90% de los datos corresponden a este grupo. En cuanto a los que si pertenecen a un grupo etnico, los registros son menores, representado con esferas de mucho menor tamaño. El grupo afrodescendiente aparece en "Desaparición Forzada", "Desplazamiento Forzado" y "En situación de desplazamiento". El grupo étnico Ébera Chami está presente en "Desplazamiento forzado" y "En situación de desplazamiento", al igual que las Negritudes, que aparecen en estas mismas dos categorías. El grupo U'wa aparece en la categoría "Víctima de minas", y los Zenú solo en "Situación de desplazamiento".

# Discusión

Interpretación de los resultados, discutir si los resultados responden a la pregunta hecha inicialmente.

# Conclusiones

Resumen del problema, resumen de como se abordo el problema (metodologia), ideas interesantes en el analisis, implicaciones para el consumidor, limitaciones de analisis y como se podria mejorar.

# Referencias
[1] Gómez, L. (2024, June 23). Aumentaron los desplazamientos forzados en Colombia: Más de 13.500 personas han sido víctimas en 2024. Infobae.
